<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤æµ‹è¯• - å°çŒ«é’“é±¼</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2d3436;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .test-button {
            background: #00b894;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #00a085;
        }
        .error {
            color: #d63031;
            font-weight: bold;
        }
        .success {
            color: #00b894;
            font-weight: bold;
        }
        .log {
            background: #2d3436;
            color: #ddd;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        canvas {
            border: 2px solid #74b9ff;
            border-radius: 8px;
            display: block;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ± å°çŒ«é’“é±¼æ¸¸æˆä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>æµ‹è¯•1: æ£€æŸ¥é”™è¯¯ä¿®å¤</h3>
            <button class="test-button" onclick="testErrorFixes()">æµ‹è¯• AnimationManager ä¿®å¤</button>
            <button class="test-button" onclick="testFishingRodInit()">æµ‹è¯• FishingRod åˆå§‹åŒ–</button>
            <div id="error-test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•2: æ¸¸æˆåŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="startGameTest()">å¯åŠ¨æ¸¸æˆæµ‹è¯•</button>
            <button class="test-button" onclick="testSceneSwitching()">æµ‹è¯•åœºæ™¯åˆ‡æ¢</button>
            <canvas id="testCanvas" width="400" height="300" style="display:none;"></canvas>
            <div id="game-test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>æ§åˆ¶å°æ—¥å¿—</h3>
            <div id="console-log" class="log"></div>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <!-- åŠ è½½æ¸¸æˆè„šæœ¬ -->
    <script src="src/adapter.js"></script>
    <script src="src/main.js"></script>
    <script src="src/animation/AnimationManager.js"></script>
    <script src="src/entities/Cat.js"></script>
    <script src="src/entities/Fish.js"></script>
    <script src="src/entities/Obstacle.js"></script>
    <script src="src/entities/PowerUp.js"></script>
    <script src="src/scenes/MainMenu.js"></script>
    <script src="src/scenes/GameScene.js"></script>
    <script src="src/scenes/GameOver.js"></script>
    <script src="src/systems/CollisionSystem.js"></script>
    <script src="src/systems/ScoreSystem.js"></script>
    <script src="src/systems/Spawner.js"></script>
    <script src="src/effects/ParticleSystem.js"></script>
    <script src="src/audio/AudioManager.js"></script>
    <script src="src/ui/UIManager.js"></script>

    <script>
        // é‡å†™ console æ–¹æ³•æ¥æ•è·æ—¥å¿—
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToLog(message, type = 'log') {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            if (type === 'error') logEntry.style.color = '#ff6b6b';
            if (type === 'warn') logEntry.style.color = '#feca57';
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog(args.join(' '), 'warn');
        };
        
        function clearLog() {
            document.getElementById('console-log').innerHTML = '';
        }
        
        function testErrorFixes() {
            const resultDiv = document.getElementById('error-test-result');
            resultDiv.innerHTML = '<p>æ­£åœ¨æµ‹è¯•é”™è¯¯ä¿®å¤...</p>';
            
            try {
                // æµ‹è¯• AnimationManager
                const animManager = new AnimationManager();
                console.log('âœ… AnimationManager åˆ›å»ºæˆåŠŸ');
                
                // æµ‹è¯• Cat ç±»
                const canvas = document.getElementById('testCanvas');
                const ctx = canvas.getContext('2d');
                const cat = new Cat(100, 100);
                console.log('âœ… Cat å®ä¾‹åˆ›å»ºæˆåŠŸ');
                
                // è®¾ç½®åŠ¨ç”»ç®¡ç†å™¨
                cat.setAnimationManager(animManager);
                console.log('âœ… AnimationManager è®¾ç½®æˆåŠŸ');
                
                // æµ‹è¯•åŠ¨ç”»æ–¹æ³•
                cat.playCastAnimation();
                console.log('âœ… playCastAnimation è°ƒç”¨æˆåŠŸ');
                
                cat.playReelAnimation();
                console.log('âœ… playReelAnimation è°ƒç”¨æˆåŠŸ');
                
                resultDiv.innerHTML = '<p class="success">âœ… æ‰€æœ‰é”™è¯¯ä¿®å¤æµ‹è¯•é€šè¿‡ï¼</p>';
                
            } catch (error) {
                console.error('âŒ é”™è¯¯ä¿®å¤æµ‹è¯•å¤±è´¥:', error.message);
                resultDiv.innerHTML = `<p class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function testFishingRodInit() {
            const resultDiv = document.getElementById('error-test-result');
            
            try {
                const cat = new Cat(100, 100);
                
                // æµ‹è¯• fishingRod åˆå§‹åŒ–
                if (cat.fishingRod) {
                    console.log('âœ… fishingRod å¯¹è±¡å·²æ­£ç¡®åˆå§‹åŒ–');
                    
                    // æµ‹è¯•è®¾ç½® isDropping å±æ€§
                    const result = cat.startFishing();
                    if (result) {
                        console.log('âœ… startFishing æˆåŠŸï¼ŒisDropping è®¾ç½®æ­£å¸¸');
                    } else {
                        console.log('âš ï¸ startFishing è¿”å› falseï¼Œå¯èƒ½å·²åœ¨é’“é±¼ä¸­');
                    }
                    
                    cat.resetFishingRod();
                    console.log('âœ… resetFishingRod è°ƒç”¨æˆåŠŸ');
                    
                    resultDiv.innerHTML += '<p class="success">âœ… FishingRod åˆå§‹åŒ–æµ‹è¯•é€šè¿‡ï¼</p>';
                } else {
                    throw new Error('fishingRod å¯¹è±¡æœªåˆå§‹åŒ–');
                }
                
            } catch (error) {
                console.error('âŒ FishingRod æµ‹è¯•å¤±è´¥:', error.message);
                resultDiv.innerHTML += `<p class="error">âŒ FishingRod æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function startGameTest() {
            const resultDiv = document.getElementById('game-test-result');
            const canvas = document.getElementById('testCanvas');
            canvas.style.display = 'block';
            
            try {
                // åˆå§‹åŒ–æ¸¸æˆå…¨å±€å¯¹è±¡
                if (!window.GameGlobal) {
                    window.GameGlobal = {
                        canvas: canvas,
                        ctx: canvas.getContext('2d'),
                        GameConfig: {
                            FISHING_SPEED: 2,
                            POWER_UPS: { speed: 1.5 }
                        },
                        GameState: {
                            powerUps: { speed: false }
                        }
                    };
                }
                
                console.log('âœ… æ¸¸æˆç¯å¢ƒåˆå§‹åŒ–æˆåŠŸ');
                resultDiv.innerHTML = '<p class="success">âœ… æ¸¸æˆæµ‹è¯•ç¯å¢ƒå¯åŠ¨æˆåŠŸï¼</p>';
                
            } catch (error) {
                console.error('âŒ æ¸¸æˆæµ‹è¯•å¤±è´¥:', error.message);
                resultDiv.innerHTML = `<p class="error">âŒ æ¸¸æˆæµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function testSceneSwitching() {
            const resultDiv = document.getElementById('game-test-result');
            
            try {
                // æµ‹è¯•åœºæ™¯ç®¡ç†å™¨
                if (window.GameGlobal && window.GameGlobal.SceneManager) {
                    console.log('âœ… SceneManager å¯ç”¨');
                    
                    // æµ‹è¯•åœºæ™¯åˆ‡æ¢
                    if (typeof window.GameGlobal.SceneManager.switchTo === 'function') {
                        console.log('âœ… switchTo æ–¹æ³•å¯ç”¨');
                        resultDiv.innerHTML += '<p class="success">âœ… åœºæ™¯åˆ‡æ¢åŠŸèƒ½æ­£å¸¸ï¼</p>';
                    } else {
                        throw new Error('switchTo æ–¹æ³•ä¸å­˜åœ¨');
                    }
                } else {
                    throw new Error('SceneManager æœªåˆå§‹åŒ–');
                }
                
            } catch (error) {
                console.error('âŒ åœºæ™¯åˆ‡æ¢æµ‹è¯•å¤±è´¥:', error.message);
                resultDiv.innerHTML += `<p class="error">âŒ åœºæ™¯åˆ‡æ¢æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', function() {
            console.log('ğŸ® ä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(() => {
                console.log('ğŸ”§ å¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
                testErrorFixes();
                testFishingRodInit();
            }, 1000);
        });
    </script>
</body>
</html>