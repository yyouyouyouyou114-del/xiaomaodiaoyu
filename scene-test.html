<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœºæ™¯åˆ‡æ¢æµ‹è¯• - å°çŒ«é’“é±¼</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            font-family: Arial, sans-serif;
        }
        
        #gameCanvas {
            border: 2px solid #333;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            display: block;
            margin: 0 auto;
            background: #87CEEB;
        }
        
        #debugInfo {
            margin-top: 20px;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .debug-line {
            margin: 2px 0;
            padding: 2px;
        }
        
        .debug-error {
            color: red;
            font-weight: bold;
        }
        
        .debug-success {
            color: green;
            font-weight: bold;
        }
        
        .debug-info {
            color: blue;
        }
        
        .debug-warning {
            color: orange;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="debugInfo">
        <div class="debug-line debug-info">åœºæ™¯åˆ‡æ¢æµ‹è¯•å¼€å§‹...</div>
    </div>

    <!-- æ¸¸æˆé…ç½® -->
    <script>
        // æ¸¸æˆå…¨å±€é…ç½®
        window.GameGlobal = {
            canvas: null,
            ctx: null,
            GameConfig: {
                CANVAS_WIDTH: 800,
                CANVAS_HEIGHT: 600,
                FISHING_SPEED: 200,
                FISH_SPAWN_RATE: 2.0,
                OBSTACLE_SPAWN_RATE: 1.0,
                POWERUP_SPAWN_RATE: 0.5,
                GAME_DURATION: 60
            },
            GameState: {
                score: 0,
                timeLeft: 60,
                isPaused: false,
                isGameOver: false,
                gameMode: 'normal'
            },
            SceneManager: null
        };
        
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(message, type = 'info') {
            const debugDiv = document.getElementById('debugInfo');
            const line = document.createElement('div');
            line.className = `debug-line debug-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugDiv.appendChild(line);
            debugDiv.scrollTop = debugDiv.scrollHeight;
            console.log(`[DEBUG-${type.toUpperCase()}] ${message}`);
        }
    </script>

    <!-- åœºæ™¯ç®¡ç†å™¨ -->
    <script>
        class SceneManager {
            constructor() {
                this.scenes = new Map();
                this.currentScene = null;
                debugLog('åœºæ™¯ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ', 'success');
            }
            
            registerScene(name, scene) {
                this.scenes.set(name, scene);
                debugLog(`æ³¨å†Œåœºæ™¯: ${name}`, 'info');
            }
            
            switchTo(sceneName) {
                debugLog(`å°è¯•åˆ‡æ¢åˆ°åœºæ™¯: ${sceneName}`, 'info');
                
                if (!this.scenes.has(sceneName)) {
                    debugLog(`åœºæ™¯ä¸å­˜åœ¨: ${sceneName}`, 'error');
                    return false;
                }
                
                // éšè—å½“å‰åœºæ™¯
                if (this.currentScene) {
                    debugLog(`éšè—å½“å‰åœºæ™¯: ${this.currentScene.constructor.name}`, 'info');
                    this.currentScene.hide();
                }
                
                // æ˜¾ç¤ºæ–°åœºæ™¯
                this.currentScene = this.scenes.get(sceneName);
                debugLog(`æ˜¾ç¤ºæ–°åœºæ™¯: ${sceneName}`, 'success');
                this.currentScene.show();
                
                return true;
            }
            
            getCurrentScene() {
                return this.currentScene;
            }
        }
        
        window.SceneManager = SceneManager;
    </script>

    <!-- ç®€åŒ–çš„ä¸»èœå•åœºæ™¯ -->
    <script>
        class TestMainMenu {
            constructor(canvas, ctx) {
                this.canvas = canvas;
                this.ctx = ctx;
                this.isVisible = false;
                this.onStartGame = null;
                
                this.startButton = {
                    x: 300,
                    y: 400,
                    width: 200,
                    height: 60
                };
                
                this.bindEvents();
                debugLog('ä¸»èœå•åœºæ™¯åˆ›å»ºå®Œæˆ', 'success');
            }
            
            bindEvents() {
                this.clickHandler = (event) => {
                    if (!this.isVisible) return;
                    
                    const rect = this.canvas.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    const y = event.clientY - rect.top;
                    
                    debugLog(`ç‚¹å‡»åæ ‡: (${x}, ${y})`, 'info');
                    
                    if (this.isPointInButton(x, y, this.startButton)) {
                        debugLog('ç‚¹å‡»äº†å¼€å§‹æ¸¸æˆæŒ‰é’®', 'success');
                        this.handleStartGame();
                    }
                };
                
                this.canvas.addEventListener('click', this.clickHandler);
            }
            
            isPointInButton(x, y, button) {
                return x >= button.x && x <= button.x + button.width &&
                       y >= button.y && y <= button.y + button.height;
            }
            
            handleStartGame() {
                debugLog('å¤„ç†å¼€å§‹æ¸¸æˆäº‹ä»¶', 'info');
                
                if (this.onStartGame) {
                    debugLog('è°ƒç”¨ onStartGame å›è°ƒ', 'info');
                    this.onStartGame();
                } else if (GameGlobal.SceneManager) {
                    debugLog('ç›´æ¥è°ƒç”¨åœºæ™¯ç®¡ç†å™¨åˆ‡æ¢', 'info');
                    GameGlobal.SceneManager.switchTo('GameScene');
                } else {
                    debugLog('æ²¡æœ‰æ‰¾åˆ°åœºæ™¯åˆ‡æ¢æ–¹æ³•', 'error');
                }
            }
            
            show() {
                this.isVisible = true;
                debugLog('ä¸»èœå•åœºæ™¯æ˜¾ç¤º', 'success');
                this.render();
            }
            
            hide() {
                this.isVisible = false;
                debugLog('ä¸»èœå•åœºæ™¯éšè—', 'info');
            }
            
            render() {
                if (!this.isVisible) return;
                
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶èƒŒæ™¯
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#4682B4');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶æ ‡é¢˜
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 48px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('å°çŒ«é’“é±¼', this.canvas.width / 2, 200);
                
                // ç»˜åˆ¶å¼€å§‹æŒ‰é’®
                this.ctx.fillStyle = '#FF6B6B';
                this.ctx.fillRect(this.startButton.x, this.startButton.y, this.startButton.width, this.startButton.height);
                
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 24px Arial';
                this.ctx.fillText('å¼€å§‹æ¸¸æˆ', this.startButton.x + this.startButton.width / 2, this.startButton.y + 40);
                
                // ç»˜åˆ¶è°ƒè¯•ä¿¡æ¯
                this.ctx.fillStyle = '#000000';
                this.ctx.font = '16px Arial';
                this.ctx.textAlign = 'left';
                this.ctx.fillText('ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®æµ‹è¯•åœºæ™¯åˆ‡æ¢', 50, 550);
            }
        }
        
        window.TestMainMenu = TestMainMenu;
    </script>

    <!-- ç®€åŒ–çš„æ¸¸æˆåœºæ™¯ -->
    <script>
        class TestGameScene {
            constructor(canvas, ctx) {
                this.canvas = canvas;
                this.ctx = ctx;
                this.isVisible = false;
                this.animationId = null;
                
                debugLog('æ¸¸æˆåœºæ™¯åˆ›å»ºå®Œæˆ', 'success');
            }
            
            show() {
                this.isVisible = true;
                debugLog('æ¸¸æˆåœºæ™¯æ˜¾ç¤º', 'success');
                this.startRenderLoop();
            }
            
            hide() {
                this.isVisible = false;
                this.stopRenderLoop();
                debugLog('æ¸¸æˆåœºæ™¯éšè—', 'info');
            }
            
            startGame(gameMode = 'normal') {
                debugLog(`æ¸¸æˆåœºæ™¯å¯åŠ¨ï¼Œæ¨¡å¼: ${gameMode}`, 'success');
                this.show();
            }
            
            startRenderLoop() {
                this.renderLoop();
            }
            
            stopRenderLoop() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
            }
            
            renderLoop() {
                if (!this.isVisible) return;
                
                this.render();
                this.animationId = requestAnimationFrame(() => this.renderLoop());
            }
            
            render() {
                if (!this.isVisible) return;
                
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶æ°´é¢èƒŒæ™¯
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(0.3, '#4682B4');
                gradient.addColorStop(1, '#191970');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶æˆåŠŸä¿¡æ¯
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 36px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('ğŸ£ æ¸¸æˆåœºæ™¯åŠ è½½æˆåŠŸï¼', this.canvas.width / 2, 200);
                
                this.ctx.font = 'bold 24px Arial';
                this.ctx.fillText('åœºæ™¯åˆ‡æ¢æ­£å¸¸å·¥ä½œ', this.canvas.width / 2, 250);
                
                // ç»˜åˆ¶å°çŒ«
                this.ctx.fillStyle = '#FFA500';
                this.ctx.fillRect(100, 100, 60, 60);
                this.ctx.fillStyle = '#000000';
                this.ctx.font = '20px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('ğŸ±', 130, 140);
                
                // ç»˜åˆ¶é±¼
                this.ctx.fillStyle = '#FF69B4';
                this.ctx.fillRect(300, 400, 40, 20);
                this.ctx.fillStyle = '#000000';
                this.ctx.font = '16px Arial';
                this.ctx.fillText('ğŸŸ', 320, 415);
                
                this.ctx.fillRect(500, 350, 40, 20);
                this.ctx.fillText('ğŸŸ', 520, 365);
                
                // ç»˜åˆ¶è°ƒè¯•ä¿¡æ¯
                this.ctx.fillStyle = '#FFFF00';
                this.ctx.font = '16px Arial';
                this.ctx.textAlign = 'left';
                this.ctx.fillText('âœ… åœºæ™¯åˆ‡æ¢æµ‹è¯•æˆåŠŸ', 50, 550);
            }
        }
        
        window.TestGameScene = TestGameScene;
    </script>

    <!-- ä¸»ç¨‹åº -->
    <script>
        function initTest() {
            debugLog('å¼€å§‹åˆå§‹åŒ–æµ‹è¯•', 'info');
            
            try {
                // åˆå§‹åŒ–ç”»å¸ƒ
                const canvas = document.getElementById('gameCanvas');
                const ctx = canvas.getContext('2d');
                
                if (!canvas || !ctx) {
                    debugLog('ç”»å¸ƒåˆå§‹åŒ–å¤±è´¥', 'error');
                    return;
                }
                
                GameGlobal.canvas = canvas;
                GameGlobal.ctx = ctx;
                debugLog('ç”»å¸ƒåˆå§‹åŒ–æˆåŠŸ', 'success');
                
                // åˆ›å»ºåœºæ™¯ç®¡ç†å™¨
                const sceneManager = new SceneManager();
                GameGlobal.SceneManager = sceneManager;
                
                // åˆ›å»ºåœºæ™¯
                const mainMenu = new TestMainMenu(canvas, ctx);
                const gameScene = new TestGameScene(canvas, ctx);
                
                // æ³¨å†Œåœºæ™¯
                sceneManager.registerScene('MainMenu', mainMenu);
                sceneManager.registerScene('GameScene', gameScene);
                
                // è®¾ç½®å›è°ƒ
                mainMenu.onStartGame = () => {
                    debugLog('æ‰§è¡Œåœºæ™¯åˆ‡æ¢å›è°ƒ', 'info');
                    
                    // æ¨¡æ‹Ÿæ¸¸æˆå¯åŠ¨é€»è¾‘
                    if (gameScene.startGame) {
                        gameScene.startGame('normal');
                    } else {
                        sceneManager.switchTo('GameScene');
                    }
                };
                
                // å¯åŠ¨ä¸»èœå•
                debugLog('åˆ‡æ¢åˆ°ä¸»èœå•åœºæ™¯', 'info');
                sceneManager.switchTo('MainMenu');
                
                debugLog('æµ‹è¯•åˆå§‹åŒ–å®Œæˆ', 'success');
                
            } catch (error) {
                debugLog(`åˆå§‹åŒ–é”™è¯¯: ${error.message}`, 'error');
                console.error('åˆå§‹åŒ–é”™è¯¯:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', initTest);
    </script>
</body>
</html>